# 実装計画

## Phase 1: MVP（最小限の動作するシステム）

### 目標
- 受講生が質問を送信 → DB保存
- スタッフが未返信一覧を見る
- テンプレを選択して返信を送る
- 基本的なエスカレーション機能

### 実装順序

#### 1. データベース設計・マイグレーション
- [x] `customers` テーブル（既存）
- [ ] `questions` テーブル作成
- [ ] `replies` テーブル作成
- [ ] `escalations` テーブル作成
- [ ] `templates` テーブル作成（初期データ含む）
- [ ] `question_notes` テーブル作成
- [ ] `users` テーブルに `role` カラム追加

#### 2. アカウントA側（質問受付）実装
- [x] Webhook受信基盤（既存）
- [ ] 質問メッセージの解析・保存
- [ ] 画像メッセージの対応
- [ ] 質問チケット作成ロジック

#### 3. アカウントB側（返信管理）実装

##### 3.1 リッチメニュー設定
- [ ] LIFF URL取得・設定
- [ ] リッチメニュー作成・登録

##### 3.2 LIFFアプリ開発

**認証**
- [ ] LIFF SDK設定
- [ ] LINEログイン実装
- [ ] ユーザー認可チェック
- [ ] セッション管理

**API Routes**
- [ ] `/api/questions` - 一覧取得
- [ ] `/api/questions/:id` - 詳細取得
- [ ] `/api/questions/:id/reply` - 返信送信
- [ ] `/api/questions/:id/escalate` - エスカレーション
- [ ] `/api/templates` - テンプレ一覧

**LIFF画面**
- [ ] `/liff/inbox` - 未返信一覧
- [ ] `/liff/thread/[id]` - 質問詳細・返信画面

#### 4. テンプレ機能
- [ ] 初期テンプレデータ作成
- [ ] テンプレ選択UI
- [ ] 変数差し込み機能
- [ ] テンプレ編集機能

#### 5. 返信送信機能
- [ ] アカウントA経由でのPush送信
- [ ] 返信履歴保存
- [ ] ステータス更新
- [ ] エラーハンドリング

### Phase 1 完了基準
- [ ] 受講生が質問を送信するとDBに保存される
- [ ] スタッフがLIFF画面で未返信一覧を見られる
- [ ] テンプレを選択して返信を送信できる
- [ ] エスカレーションが作成できる
- [ ] 返信後、ステータスが更新される

## Phase 2: 運用強化

### 追加機能
- [ ] カテゴリ分類機能
- [ ] 担当者割当機能
- [ ] SLA管理（期限表示・アラート）
- [ ] 内部メモ機能
- [ ] テンプレ管理画面（CRUD）
- [ ] 検索・フィルタ機能強化
- [ ] ファイル添付対応

## Phase 3: 高度な機能

### 追加機能
- [ ] 承認フロー
- [ ] 分析ダッシュボード
- [ ] ナレッジ化機能
- [ ] Slack通知連携
- [ ] 返信品質分析

